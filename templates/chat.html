<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="header">
    <h2>RDGMC Chat Group</h2>
    <hr>
</div>

<div class="container">

{% if muted %}
<p style="color:red;text-align:center;">You are muted temporarily</p>
{% endif %}

{% if admin %}
<form method="post" action="/send">
    <input name="msg" placeholder="Admin announcement">
    <input type="hidden" name="announcement" value="1">
    <button>Send Announcement</button>
</form>
{% endif %}

<div class="chat-box" id="chat"></div>

{% if not muted %}
<form method="post" action="/send">
    <input name="msg" placeholder="Type message" required>
    <button>Send</button>
</form>
{% endif %}

</div>

<script>
function load(){
 fetch("/messages").then(r=>r.json()).then(d=>{
  let h="";
  d.forEach(m=>{
   h+=`<div class="msg ${m[3]=='announcement'?'announcement':''}">
   <b>${m[1]}</b>: ${m[2]}
   <a href="/report/${m[0]}">ğŸš©</a>
   {% if admin %}
     <a href="/delete_msg/${m[0]}">âŒ</a>
     <a href="/mute/${m[1]}">ğŸ”‡</a>
   {% endif %}
   </div>`;
  });
  document.getElementById("chat").innerHTML=h;
 });
}
setInterval(load,3000);
load();
</script>

</body>
</html>
